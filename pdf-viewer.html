<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #pdf-viewer {
            display: flex;
            height: 100vh;
        }
        #sidebar {
            width: 200px;
            background: #f4f4f4;
            border-right: 1px solid #ccc;
            overflow-y: auto;
        }
        #viewer-container {
            flex-grow: 1;
            overflow: auto;
        }
        .page-container {
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #toolbar {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #fff;
            border-bottom: 1px solid #ccc;
        }
        #toolbar button {
            background: none;
            border: none;
            cursor: pointer;
        }
        #toolbar input {
            width: 50px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="pdf-viewer">
        <div id="sidebar">
            <h3>Document Outline</h3>
            <ul id="outline-list"></ul>
        </div>
        <div id="viewer-container">
            <div id="toolbar">
                <button id="prev-page">Previous</button>
                <input type="number" id="page-num" value="1" min="1" readonly>
                <button id="next-page">Next</button>
                <button id="zoom-in">+</button>
                <button id="zoom-out">-</button>
            </div>
            <div id="pdf-viewer"></div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const pdfUrl = urlParams.get('file');

        if (!pdfUrl) {
            document.getElementById('pdf-viewer').innerHTML = '<p style="color: red; text-align: center; margin-top: 20px;">No PDF file specified in the URL.</p>';
            throw new Error('No PDF file specified in the URL.');
        }

        const container = document.getElementById('pdf-viewer');
        const pageNumInput = document.getElementById('page-num');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');
        const zoomInButton = document.getElementById('zoom-in');
        const zoomOutButton = document.getElementById('zoom-out');
        const outlineList = document.getElementById('outline-list');

        let pdfDoc = null;
        let currentPage = 1;
        let zoomLevel = 1.0;

        function renderPage(page) {
            const scale = zoomLevel;
            const viewport = page.getViewport({ scale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            canvas.style.width = viewport.width + 'px';
            canvas.style.height = viewport.height + 'px';

            const pageContainer = document.createElement('div');
            pageContainer.className = 'page-container';
            pageContainer.appendChild(canvas);
            container.appendChild(pageContainer);

            context.scale(zoomLevel, zoomLevel);

            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };
            page.render(renderContext);
        }

        function render() {
            container.innerHTML = '';
            pdfDoc.getPage(currentPage).then(page => {
                renderPage(page);
                pageNumInput.value = currentPage;
            });
        }

        function loadOutline() {
            pdfDoc.getOutline().then(outline => {
                outlineList.innerHTML = '';
                outline.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item.title;
                    li.addEventListener('click', () => {
                        currentPage = item.dest[0];
                        render();
                    });
                    outlineList.appendChild(li);
                });
            });
        }

        pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
            pdfDoc = pdf;
            loadOutline();
            render();
        }).catch(error => {
            console.error('Error loading PDF: ', error);
            document.getElementById('pdf-viewer').innerHTML = `<p style="color: red; text-align: center; margin-top: 20px;">Error loading PDF: ${error.message}</p>`;
        });

        prevPageButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                render();
            }
        });

        nextPageButton.addEventListener('click', () => {
            if (currentPage < pdfDoc.numPages) {
                currentPage++;
                render();
            }
        });

        zoomInButton.addEventListener('click', () => {
            zoomLevel += 0.1;
            render();
        });

        zoomOutButton.addEventListener('click', () => {
            if (zoomLevel > 0.2) {
                zoomLevel -= 0.1;
                render();
            }
        });
    </script>
</body>
</html>
